(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["4837c530"],{3482:function(t,o,e){},5018:function(t,o,e){"use strict";e.r(o);var i=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"mypage"},[e("TitleBar",{attrs:{titleTx:t.title}}),e("div",{staticClass:"myblock",staticStyle:{"overflow-y":"auto",flex:"1"}},t._l(t.messages,function(o){return e("div",{key:o.index,staticClass:"msg-item",style:!0===o.my?"align-items: flex-end;":"align-items: flex-start;"},[e("div",{staticClass:"mytx-tip"},[t._v(t._s(o.name))]),e("div",{staticClass:"msgbox",style:!0===o.my?"background-color: #e0e0e0;":"background-color: #81c784"},[t._v(t._s(o.text))])])})),e("div",{staticStyle:{display:"flex",margin:"10px"}},[e("q-input",{staticStyle:{flex:"1"},model:{value:t.sendTx,callback:function(o){t.sendTx=o},expression:"sendTx"}}),e("q-btn",{staticStyle:{width:"20%","margin-left":"5px"},attrs:{label:"发送",color:"primary"},on:{click:t.sendMsg}})],1)],1)},n=[];i._withStripped=!0;var s=e("9bfb"),a=(e("3452"),e("6821f")),l=e.n(a),r={components:{TitleBar:s["a"]},data:function(){return{title:"聊天室",sendTx:"",messages:[]}},mounted:function(){console.log("-----Chat Room mounted"),this.enterChatroom()},methods:{enterChatroom:function(){var t=this;JIM.enterChatroom({id:this.global.jim.pubchatroom}).onSuccess(function(o){console.log("enterChatroom ok"),0===o.code&&t.onRoomMsg()}).onFail(function(o){console.log("enterChatroom error:"+JSON.stringify(o)),881507===o.code&&(console.log("vvvvvvvvvvvvv"),t.onRoomMsg())})},onRoomMsg:function(){var t=this;JIM.onRoomMsg(function(o){var e=o.content.from_id,i=e.length<=5?e:e.substring(e.length-5),n=e===t.global.wallet.ethAddress.substring(2);t.showMsg(o.content.msg_body.text,i,n)})},showMsg:function(t,o,e){this.messages.push({name:e?"我":o,text:t,my:e});var i=document.querySelector(".myblock");this.$nextTick(function(){i.scrollTop=i.scrollHeight})},jiminit:function(){var t=this;window.JIM=new JMessage({debug:this.global.jim.debug});var o={appkey:this.global.jim.appkey,random_str:this.util.randomWord(!0,20,36),signature:"",timestamp:(new Date).getTime(),flag:this.global.jim.flag};o.signature=l()("appkey="+o.appkey+"&timestamp="+o.timestamp+"&random_str="+o.random_str+"&key="+this.global.jim.secret),JIM.init(o).onSuccess(function(o){t.jimlogin()}).onFail(function(t){})},jimlogin:function(){var t=this,o=this.global.wallet.ethAddress;JIM.login({username:o===this.global.jim.ok0x?"ok0x":o.substring(2),password:"123456"}).onSuccess(function(o){t.enterChatroom()}).onFail(function(o){console.log("error:"+JSON.stringify(o)),880103===o.code&&t.jimregister()}).onTimeout(function(t){console.log("timeout:"+JSON.stringify(t))})},jimregister:function(){var t=this,o=this.global.wallet.ethAddress;JIM.register({username:o===this.global.jim.ok0x?"ok0x":o.substring(2),password:"123456",nickname:this.global.wallet.ethAddress.substring(37)}).onSuccess(function(o){t.jimlogin()}).onFail(function(t){console.log("error:"+JSON.stringify(t))})},sendMsg:function(){var t=this;return JIM.isInit()?JIM.isLogin()?void(""!==this.sendTx&&JIM.sendChatroomMsg({target_rid:this.global.jim.pubchatroom,content:this.sendTx}).onSuccess(function(o,e){t.messages.push({name:"我",text:t.sendTx,my:!0}),t.sendTx="";var i=document.querySelector(".myblock");t.$nextTick(function(){i.scrollTop=i.scrollHeight})}).onFail(function(t){console.log(t)})):(toast("正在重连,请稍后..."),void this.jimlogin()):(toast("正在重连,请稍后..."),void this.jiminit())}},beforeDestroy:function(){JIM.exitChatroom({id:this.global.jim.pubchatroom}),console.log("-----Chat Room beforeDestroy")}},c=r,u=(e("668f"),e("2877")),m=Object(u["a"])(c,i,n,!1,null,"81988c74",null);m.options.__file="ChatRoom.vue";o["default"]=m.exports},"668f":function(t,o,e){"use strict";var i=e("3482"),n=e.n(i);n.a},"9bfb":function(t,o,e){"use strict";var i=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"title-bar"},[!1!==t.showBack?e("q-icon",{staticClass:"title-back-icon",attrs:{name:"navigate_before"},nativeOn:{click:function(o){return t.goBack(o)}}}):t._e(),e("div",{staticClass:"title-tx"},[t._v(t._s(t.titleTx))])],1)},n=[];i._withStripped=!0;var s={props:["titleTx","showBack"],methods:{goBack:function(){this.$router.go(-1)}}},a=s,l=(e("a675"),e("2877")),r=Object(l["a"])(a,i,n,!1,null,null,null);r.options.__file="TitleBar.vue";o["a"]=r.exports},a675:function(t,o,e){"use strict";var i=e("ca51"),n=e.n(i);n.a},ca51:function(t,o,e){}}]);