(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["1edb437a"],{"1e1d":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"title-bar"},[!1!==t.showBack?s("q-icon",{staticClass:"title-back-icon",attrs:{name:"navigate_before"},nativeOn:{click:function(e){return t.goBack(e)}}}):t._e(),s("div",{staticClass:"title-tx"},[t._v(t._s(t.titleTx))])],1)},n=[],o={props:["titleTx","showBack"],methods:{goBack:function(){this.$router.go(-1)}}},a=o,r=(s("5854"),s("2877")),l=Object(r["a"])(a,i,n,!1,null,null,null);e["a"]=l.exports},5854:function(t,e,s){"use strict";var i=s("b722"),n=s.n(i);n.a},ab55:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mypage"},[s("TitleBar",{attrs:{titleTx:t.converData.nickName}}),s("div",{staticClass:"myblock",staticStyle:{"overflow-y":"auto",flex:"1"}},t._l(t.messages,(function(t,e){return s("q-chat-message",{key:"reg-"+e,attrs:{label:t.label,sent:t.sent,"text-color":t.textColor,"bg-color":t.bgColor,name:t.name,avatar:t.avatar,text:t.text,stamp:t.stamp}})})),1),s("div",{staticStyle:{display:"flex",margin:"10px"}},[s("q-input",{staticStyle:{flex:"1"},attrs:{dense:!0},model:{value:t.sendTx,callback:function(e){t.sendTx=e},expression:"sendTx"}}),s("q-btn",{staticStyle:{width:"20%","margin-left":"5px"},attrs:{label:"发送",color:"primary"},on:{click:t.sendMsg}})],1)],1)},n=[],o=s("1e1d"),a=(s("3452"),s("6821f")),r=s.n(a),l={components:{TitleBar:o["a"]},data:function(){return{converData:{},sendTx:"",messages:[]}},mounted:function(){this.converData=this.$route.query.item,JIM.isInit()?JIM.isLogin()?(this.onlinemsgreceive(),this.showUnreadMsg()):this.jimlogin():this.jiminit()},methods:{showUnreadMsg:function(){for(var t=[],e=this.global.jim.offlineMsg,s=0;s<e.length;s++)if(e[s].from_username===this.converData.username){for(var i=e[s].msgs,n=[],o=0;o<i.length;o++)this.showMsg(i[o].content.msg_body.text,this.util.convertUTCTimeToLocalTime(i[o].ctime_ms).substring(5)),n.push(i[o].msg_id);this.singleReceiptReport(n),t.push(s);break}for(var a=0;a<t.length;a++)this.global.jim.offlineMsg.splice(t[a],1);t=[];for(var r=this.global.jim.onlineMsg,l=[],c=0;c<r.length;c++)r[c].from_username===this.converData.username&&(this.showMsg(r[c].text,this.util.convertUTCTimeToLocalTime(r[c].ctime_ms).substring(5)),l.push(r[c].msg_id),t.push(c));this.singleReceiptReport(l);for(var m=0;m<t.length;m++)this.global.jim.onlineMsg.splice(t[m],1)},singleReceiptReport:function(t){0!==t.length&&JIM.addSingleReceiptReport({username:this.converData.username,msg_ids:t}).onSuccess((function(t,e){})).onFail((function(t,e){}))},onlinemsgreceive:function(){var t=this;JIM.onMsgReceive((function(e){for(var s=e.messages,i=0;i<s.length;i++)if(s[i].from_username===t.converData.username){t.showMsg(s[i].content.msg_body.text,t.util.convertUTCTimeToLocalTime(s[i].content.create_time).substring(5));var n=[];n.push(s[i].msg_id),t.singleReceiptReport(n)}else t.global.jim.onlineMsg.push({ctime_ms:s[i].ctime_ms,from_username:s[i].from_username,msg_id:s[i].msg_id,text:s[i].content.msg_body.text})}))},showMsg:function(t,e){this.messages.push({name:"",text:[t],sent:!1,avatar:this.$route.query.item.avatar,stamp:e});var s=document.querySelector(".myblock");this.$nextTick((function(){s.scrollTop=s.scrollHeight}))},jiminit:function(){var t=this;window.JIM=new JMessage({debug:this.global.jim.debug});var e={appkey:this.global.jim.appkey,random_str:this.util.randomWord(!0,20,36),signature:"",timestamp:(new Date).getTime(),flag:this.global.jim.flag};e.signature=r()("appkey="+e.appkey+"&timestamp="+e.timestamp+"&random_str="+e.random_str+"&key="+this.global.jim.secret),JIM.init(e).onSuccess((function(e){t.jimlogin()})).onFail((function(t){}))},jimlogin:function(){var t=this,e=this.global.wallet.ethAddress;JIM.login({username:e===this.global.jim.ok0x?"ok0x":e.substring(2),password:"123456"}).onSuccess((function(e){t.onlinemsgreceive(),t.showUnreadMsg()})).onFail((function(e){880103===e.code&&t.jimregister()})).onTimeout((function(t){}))},jimregister:function(){var t=this,e=this.global.wallet.ethAddress;JIM.register({username:e===this.global.jim.ok0x?"ok0x":e.substring(2),password:"123456",nickname:this.global.wallet.ethAddress.substring(37)}).onSuccess((function(e){t.jimlogin()})).onFail((function(t){}))},sendMsg:function(){var t=this;return JIM.isInit()?JIM.isLogin()?void(""!==this.sendTx&&JIM.sendSingleMsg({target_username:this.converData.username,content:this.sendTx}).onSuccess((function(e,s){t.messages.push({name:"",text:[t.sendTx],sent:!0,avatar:t.global.user.avatar,stamp:t.util.convertUTCTimeToLocalTime(new Date).substring(5)}),t.sendTx="";var i=document.querySelector(".myblock");t.$nextTick((function(){i.scrollTop=i.scrollHeight}))})).onFail((function(t){}))):(toast("正在重新连接,请稍后..."),void this.jimlogin()):(toast("正在重新连接,请稍后..."),void this.jiminit())}},beforeDestroy:function(){JIM.resetUnreadCount({username:this.converData.username})}},c=l,m=s("2877"),u=Object(m["a"])(c,i,n,!1,null,"e5416612",null);e["default"]=u.exports},b722:function(t,e,s){}}]);