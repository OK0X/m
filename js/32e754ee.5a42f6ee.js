(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["32e754ee"],{"1e1d":function(t,e,s){"use strict";var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"title-bar"},[!1!==t.showBack?s("q-icon",{staticClass:"title-back-icon",attrs:{name:"navigate_before"},nativeOn:{click:function(e){return t.goBack(e)}}}):t._e(),s("div",{staticClass:"title-tx"},[t._v(t._s(t.titleTx))])],1)},n=[],o={props:["titleTx","showBack"],methods:{goBack:function(){this.$router.go(-1)}}},a=o,l=(s("5854"),s("2877")),r=Object(l["a"])(a,i,n,!1,null,null,null);e["a"]=r.exports},5018:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"mypage"},[s("TitleBar",{attrs:{titleTx:t.title}}),s("div",{staticClass:"myblock",staticStyle:{"overflow-y":"auto",flex:"1"}},t._l(t.messages,(function(e){return s("div",{key:e.index,staticClass:"msg-item",style:!0===e.my?"align-items: flex-end;":"align-items: flex-start;"},[s("div",{staticClass:"mytx-tip"},[t._v(t._s(e.name))]),s("div",{staticClass:"msgbox",style:!0===e.my?"background-color: #e0e0e0;":"background-color: #81c784"},[t._v(t._s(e.text))])])})),0),s("div",{staticStyle:{display:"flex",margin:"10px"}},[s("q-input",{staticStyle:{flex:"1"},attrs:{dense:!0},model:{value:t.sendTx,callback:function(e){t.sendTx=e},expression:"sendTx"}}),s("q-btn",{staticStyle:{width:"20%","margin-left":"5px"},attrs:{label:"发送",color:"primary"},on:{click:t.sendMsg}})],1)],1)},n=[],o=s("1e1d"),a=(s("3452"),s("6821f")),l=s.n(a),r={components:{TitleBar:o["a"]},data:function(){return{title:"聊天室",sendTx:"",messages:[]}},mounted:function(){this.enterChatroom()},methods:{enterChatroom:function(){var t=this;JIM.enterChatroom({id:this.global.jim.pubchatroom}).onSuccess((function(e){0===e.code&&t.onRoomMsg()})).onFail((function(e){881507===e.code&&t.onRoomMsg()}))},onRoomMsg:function(){var t=this;JIM.onRoomMsg((function(e){var s=e.content.from_id,i=s.length<=5?s:s.substring(s.length-5),n=s===t.global.wallet.ethAddress.substring(2);t.showMsg(e.content.msg_body.text,i,n)}))},showMsg:function(t,e,s){this.messages.push({name:s?"我":e,text:t,my:s});var i=document.querySelector(".myblock");this.$nextTick((function(){i.scrollTop=i.scrollHeight}))},jiminit:function(){var t=this;window.JIM=new JMessage({debug:this.global.jim.debug});var e={appkey:this.global.jim.appkey,random_str:this.util.randomWord(!0,20,36),signature:"",timestamp:(new Date).getTime(),flag:this.global.jim.flag};e.signature=l()("appkey="+e.appkey+"&timestamp="+e.timestamp+"&random_str="+e.random_str+"&key="+this.global.jim.secret),JIM.init(e).onSuccess((function(e){t.jimlogin()})).onFail((function(t){}))},jimlogin:function(){var t=this,e=this.global.wallet.ethAddress;JIM.login({username:e===this.global.jim.ok0x?"ok0x":e.substring(2),password:"123456"}).onSuccess((function(e){t.enterChatroom()})).onFail((function(e){880103===e.code&&t.jimregister()})).onTimeout((function(t){}))},jimregister:function(){var t=this,e=this.global.wallet.ethAddress;JIM.register({username:e===this.global.jim.ok0x?"ok0x":e.substring(2),password:"123456",nickname:this.global.wallet.ethAddress.substring(37)}).onSuccess((function(e){t.jimlogin()})).onFail((function(t){}))},sendMsg:function(){var t=this;return JIM.isInit()?JIM.isLogin()?void(""!==this.sendTx&&JIM.sendChatroomMsg({target_rid:this.global.jim.pubchatroom,content:this.sendTx}).onSuccess((function(e,s){t.messages.push({name:"我",text:t.sendTx,my:!0}),t.sendTx="";var i=document.querySelector(".myblock");t.$nextTick((function(){i.scrollTop=i.scrollHeight}))})).onFail((function(t){}))):(toast("正在重连,请稍后..."),void this.jimlogin()):(toast("正在重连,请稍后..."),void this.jiminit())}},beforeDestroy:function(){JIM.exitChatroom({id:this.global.jim.pubchatroom})}},c=r,u=(s("d9f3"),s("2877")),m=Object(u["a"])(c,i,n,!1,null,"4854e0f6",null);e["default"]=m.exports},5854:function(t,e,s){"use strict";var i=s("b722"),n=s.n(i);n.a},a638:function(t,e,s){},b722:function(t,e,s){},d9f3:function(t,e,s){"use strict";var i=s("a638"),n=s.n(i);n.a}}]);